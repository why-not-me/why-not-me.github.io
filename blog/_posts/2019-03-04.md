---
title: 重排、重绘和合成
date: 2019-03-04
author: WangJunMing
location: HangZhou
tags:
  - 浏览器
---

在浏览器的渲染流水线，**重排、重绘、合成**这三个概念经常被提及，因为它们和 web 性能优化有着密切的关系。

## 什么叫重排

当我们通过 js 修改元素样式或者修改 css 样式表，将页面中 DOM 元素的几何属性改变后，例如修改元素的宽、高或者定位，那么浏览器就会触发重新布局，重新走一遍渲染流水线，这个过程就叫做重排。这个过程开销是很大的。

## 什么叫重绘

当我们通过 js 修改元素样式或者修改 css 样式表，只是更改元素的绘制属性，比如元素的背景颜色、透明度之类的，浏览器是不会触发重新布局的，仅仅只是重新进入绘制阶段，这个过程就叫做重绘。和重排做比较，重绘省去了布局阶段和分层阶段，所以执行效率要比重排高一些。

## 什么叫合成

如果我们更改一个既不要布局也不要绘制的属性，那么渲染引擎将跳过布局和绘制，只执行后续的合成操作，我们就把这个过程叫做合成。比如修改`transform`属性，使用`transform: translate(10px, 20px)`对元素做一个动画效果，就是合成，可以避开重排和重绘，直接在非主线程上执行合成动画操作。因为是在非主线程上合成，并没有占用主线程的资源，另外也避开了布局和绘制两个子阶段，所以相对于重绘和重排，合成能大大提升绘制效率。

## transform 和 transition 有什么区别

`transform`，译为变换，表示变换元素的行为或者元素的状态，`transform`属性允许我们旋转，缩放，倾斜或平移给定元素，这是通过修改 CSS 视觉格式化模型的坐标空间来实现的。一般来说，只能转换由盒模型定位的元素。根据经验，如果元素具有 display: block，则由盒模型定位元素。

`transition`，译为过渡，可以为元素在不同状态之间切换的时候定义不同的过渡效果。`transition`是`transition-property`、`transition-duration`、`transition-timing-function`、`transition-delay`几个属性的简写。

## 小结

页面交互时要避免重排，因为开销太大。而重绘和合成开销少，可以适当朝这两者靠拢。
